<!DOCTYPE html>
<html>
<head>
    <title>Checkout</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css" media="screen" type="text/css" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
</head>

<body id="checkout-page">

    <div id="site">
        <header id="masthead">
            <h1>Checkout</h1>
        </header>
        <div id="content">
            <h1>Checkout</h1>
            <table id="checkout-cart" class="shopping-cart">
                <thead>
                    <tr>
                        <th scope="col">Item</th>
                        <th scope="col">Qty</th>
                        <th scope="col">Price</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Items will be dynamically added here -->
                </tbody>
            </table>
            <div id="pricing">
                <p id="shipping"><strong>Shipping</strong>: R 100.00</p>
                <p id="sub-total"><strong>Total</strong>: <span id="stotal">R 0.00</span></p>
            </div>

            <form action="#" method="post" id="checkout-order-form" novalidate>
                <h2>Your Details</h2>
                <fieldset id="fieldset-billing">
                    <legend>Billing</legend>
                    <div>
                        <label for="name">Name</label>
                        <input type="text" name="name" id="name" data-message="This field cannot be empty" required />
                    </div>
                    <div>
                        <label for="email">Email</label>
                        <input type="email" name="email" id="email" data-message="Not a valid email address" required />
                    </div>
                    <div>
                        <label for="city">City</label>
                        <input type="text" name="city" id="city" data-message="This field cannot be empty" required />
                    </div>
                    <div>
                        <label for="address">Address</label>
                        <input type="text" name="address" id="address" data-message="This field cannot be empty" required />
                    </div>
                    <div>
                        <label for="zip">ZIP Code</label>
                        <input type="text" name="zip" id="zip" pattern="^[0-9]{4,5}$" title="ZIP code must be 4-5 digits" data-message="This field cannot be empty" required />
                    </div>
                    <div>
                        <label for="country">Country</label>
                        <select name="country" id="country" data-message="This field cannot be empty" required>
                            <option value="">Select</option>
                            <option value="EC">Eastern Cape</option>
                            <option value="FS">Free State</option>
                            <option value="GP">Gauteng</option>
                            <option value="KZN">KwaZulu-Natal</option>
                            <option value="LP">Limpopo</option>
                            <option value="MP">Mpumalanga</option>
                            <option value="NC">Northern Cape</option>
                            <option value="NW">North West</option>
                            <option value="WC">Western Cape</option>
                        </select>
                    </div>
                </fieldset>

                <div id="shipping-same">Same as Billing <input type="checkbox" id="same-as-billing" value=""/></div>

                <fieldset id="fieldset-shipping">
                    <legend>Shipping</legend>

                    <div>
                        <label for="sname">Name</label>
                        <input type="text" name="sname" id="sname" data-type="string" data-message="This field cannot be empty" />
                    </div>
                    <div>
                        <label for="semail">Email</label>
                        <input type="text" name="semail" id="semail" data-type="expression" data-message="Not a valid email address" />
                    </div>
                    <div>
                        <label for="scity">City</label>
                        <input type="text" name="scity" id="scity" data-type="string" data-message="This field cannot be empty" />
                    </div>
                    <div>
                        <label for="saddress">Address</label>
                        <input type="text" name="saddress" id="saddress" data-type="string" data-message="This field cannot be empty" />
                    </div>
                    <div>
                        <label for="szip">ZIP Code</label>
                        <input type="text" name="szip" id="szip" pattern="^[0-9]{4,5}$" title="ZIP code must be 4-5 digits" data-message="This field cannot be empty" />
                    </div>
                    <div>
                        <label for="scountry">Province</label>
                        <select name="scountry" id="scountry" data-type="string" data-message="This field cannot be empty">
                            <option value="">Select</option>
                            <option value="EC">Eastern Cape</option>
                            <option value="FS">Free State</option>
                            <option value="GP">Gauteng</option>
                            <option value="KZN">KwaZulu-Natal</option>
                            <option value="LP">Limpopo</option>
                            <option value="MP">Mpumalanga</option>
                            <option value="NC">Northern Cape</option>
                            <option value="NW">North West</option>
                            <option value="WC">Western Cape</option>
                        </select>
                    </div>
                </fieldset>

                <p><input type="submit" id="submit-order" value="Submit" class="btn" /></p>
            </form>
        </div>
    </div>

    <footer id="site-info">Copyright &copy;</footer>

    <!-- Add JavaScript to dynamically load cart data -->
    <script>
        // Function to load cart from localStorage and display in the checkout table
        function loadCart() {
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            const cartTable = document.querySelector('#checkout-cart tbody');
            const subTotalElement = document.getElementById('stotal');
            const shippingCost = 100.00;  // Fixed shipping cost
            let subTotal = 0;

            cartTable.innerHTML = '';  // Clear any existing items in the table

            // Loop through each item in the cart and create a row
            cart.forEach(item => {
                const row = document.createElement('tr');

                const nameCell = document.createElement('td');
                nameCell.textContent = item.name;
                row.appendChild(nameCell);

                const qtyCell = document.createElement('td');
                qtyCell.textContent = item.quantity;
                row.appendChild(qtyCell);

                const priceCell = document.createElement('td');
                priceCell.textContent = 'R ' + (item.price * item.quantity).toFixed(2);
                row.appendChild(priceCell);

                cartTable.appendChild(row);

                // Calculate the subtotal
                subTotal += item.price * item.quantity;
            });

            // Update the subtotal and total (including shipping)
            const total = subTotal + shippingCost;
            subTotalElement.textContent = 'R ' + total.toFixed(2);
        }

        // Call the loadCart function on page load
        document.addEventListener('DOMContentLoaded', loadCart);
    </script>

    <script type="text/javascript">
        $(document).ready(function() {
            // Function to toggle visibility of shipping fields
            $('#same-as-billing').on('change', function() {
                if (this.checked) {
                    $('#fieldset-shipping').hide();
                } else {
                    $('#fieldset-shipping').show();
                }
            });
        });
    </script>
	    <script>
			// JavaScript validation for billing and shipping
			document.getElementById('checkout-order-form').addEventListener('submit', function(event) {
				var form = this;
				var isValid = true;
				var requiredFields = form.querySelectorAll('[required]');
		
				// Validate billing fields
				requiredFields.forEach(function(field) {
					if (!field.value) {
						alert(field.getAttribute('data-message'));
						field.focus();
						isValid = false;
						event.preventDefault(); // Stop form submission if invalid
					}
				});
		
				// ZIP code validation
				var zipField = document.getElementById('zip');
				var zipPattern = /^[0-9]{4,5}$/;
				if (!zipPattern.test(zipField.value)) {
					alert("Please enter a valid ZIP code (4-5 digits).");
					zipField.focus();
					isValid = false;
					event.preventDefault();
				}
		
				// Check if a country is selected
				var countryField = document.getElementById('country');
				if (!countryField.value) {
					alert("Please select a country.");
					countryField.focus();
					isValid = false;
					event.preventDefault();
				}
		
				// If not using same as billing, validate shipping fields
				if (!document.getElementById('same-as-billing').checked) {
					var shippingFields = document.querySelectorAll('#fieldset-shipping [data-message]');
					shippingFields.forEach(function(field) {
						if (!field.value) {
							alert(field.getAttribute('data-message'));
							field.focus();
							isValid = false;
							event.preventDefault();
						}
					});
		
					// ZIP code validation for shipping
					var sZipField = document.getElementById('szip');
					if (!zipPattern.test(sZipField.value)) {
						alert("Please enter a valid ZIP code (4-5 digits) for shipping.");
						sZipField.focus();
						isValid = false;
						event.preventDefault();
					}
		
					// Check if a province is selected
					var sCountryField = document.getElementById('scountry');
					if (!sCountryField.value) {
						alert("Please select a province.");
						sCountryField.focus();
						isValid = false;
						event.preventDefault();
					}
				}
		
				// If the form is valid, store the total amount in localStorage and redirect
				if (isValid) {
					var totalAmount = document.getElementById('stotal').innerText; // Get the total from the span
					localStorage.setItem('checkoutTotal', totalAmount); // Store it in localStorage
					
					// Redirect to order.html
					window.location.href = 'oder';
					
				}
		
				return false; // Prevent form submission
			});
			</script>
		
			<script type="text/javascript">
				$(document).ready(function() {
					// Function to toggle visibility of shipping fields
					$('#same-as-billing').on('change', function() {
						if (this.checked) {
							$('#fieldset-shipping').hide();
						} else {
							$('#fieldset-shipping').show();
						}
					});
				});
			</script>
		

</body>
</html>
